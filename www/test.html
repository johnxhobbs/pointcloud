<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Viewer Test Harness</title>
  <!-- 
    NOTE: This test page must be served via HTTP (not file://) to work in modern browsers like Chrome,
    because ES modules and some scripts are blocked for security reasons when loaded from file://.
    Use RStudio Viewer, or run a local web server such as:
      python -m http.server 8000
    ...then open http://localhost:8000/www/test.html in your browser.
  -->
  <!-- External libraries: loaded from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/utif@3.0.0/UTIF.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gl-matrix@3.4.3/gl-matrix-min.js"></script>
  <style>
    #glviewer-container {
      width: 640px;
      height: 480px;
      border: 1px solid #ccc;
      margin-top: 1em;
      position: relative;
    }
    .viewer-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>
<body>
  <h2>Manual Viewer Test</h2>
  <input type="file" id="fileInput" accept=".tif,.tiff,image/tiff">
  <div id="glviewer-container"></div>

  <script type="module">
    import { initViewer } from './main.js';

    const container = document.getElementById('glviewer-container');
    const viewer = initViewer(container);

    // Example: wire up file input to viewer (user to adjust as per actual API)
    document.getElementById('fileInput').addEventListener('change', function (evt) {
      const file = evt.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        // Assume viewer exposes a loadTIFF(buffer) method
        if (container.canvas && container.canvas.viewer && container.canvas.viewer.loadTIFF) {
          container.canvas.viewer.loadTIFF(e.target.result);
        } else {
          // fallback or error
          alert('Viewer not ready or loadTIFF not implemented!');
        }
      };
      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
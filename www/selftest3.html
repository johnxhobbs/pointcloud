<!DOCTYPE html>
<!--
  selftest3.html - 10 million point cloud (texture-based, WebGL2, float texture)
  - Stores all point positions in a float RGBA32F texture
  - Vertex shader fetches position via gl_VertexID
  - Controls, UI, and camera matched to selftest2.html
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebGL2 Point Cloud Selftest3 (10M pts, texture-based)</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; background: #222; }
    body { width: 100vw; height: 100vh; overflow: hidden; }
    #glcanvas { width: 100vw; height: 100vh; display: block; background: #111; }
    #instructions {
      position: absolute; top: 12px; left: 12px; background: rgba(0,0,0,0.6); color: #fff;
      padding: 10px 16px; border-radius: 7px; font-family: monospace; z-index: 10; font-size: 15px;
    }
  </style>
  <!-- Minimal gl-matrix for mat4 (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/gl-matrix@3.4.3/gl-matrix-min.js"></script>
  <script src="https://unpkg.com/utif@3.1.0/UTIF.min.js"></script>
</head>
<body>
        <canvas id="glcanvas"></canvas>
        <script type="text/javascript">

async function init() {
    // Load TIFF file
    const response = await fetch("img/AMTGRP5000--20151208014108m.zfs.tiff");
    const arrayBuffer = await response.arrayBuffer();

    // Decode TIFF using UTIF.js
    const ifds = UTIF.decode(arrayBuffer);
    UTIF.decodeImages(arrayBuffer, ifds);

    // Assume first IFD contains main image
    const img = ifds[0];
    const texData = UTIF.toRGBA8(img); // Uint8ClampedArray, RGBA
    const TEX_W = img.width;
    const TEX_H = img.height;

    // For demonstration, treat each pixel as a point (can adjust as needed)
    const POINT_COUNT = TEX_W * TEX_H;
    const positions = new Float32Array(POINT_COUNT * 3);
    for(let y=0; y<TEX_H; ++y) {
        for(let x=0; x<TEX_W; ++x) {
            const idx = y * TEX_W + x;
            positions[idx*3+0] = (x / TEX_W) * 2 - 1;
            positions[idx*3+1] = (y / TEX_H) * 2 - 1;
            positions[idx*3+2] = 0;
        }
    }
    // WebGL setup goes here, using positions and texData (converted to appropriate format)

    // ... rest of setup and rendering code, moved here ...
}
init();

        </script>
    </body>
</html>